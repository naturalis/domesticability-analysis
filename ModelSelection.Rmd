---
title: "ModelSelection"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T)
```


# Model Selection
The Generalized Linear Model (GLM) must be made. The Domestication column is used as the dependent 
variable, and the other columns are the predictor variables. For the model selection the phylolm package 
and phyloglmstep function are used.


### Load packages
```{r packages}
library(phylolm)
source("https://raw.githubusercontent.com/naturalis/angiosperm-traits/master/phyloglmstep.R")
```


### Load data

The dataset and predictors variables are declared in the 'Pipeline.Rmd' script to prevent redundant code.

```{r data}
# Declare dataset which contains both the dependent as the predictor variables
dataModel <- cbind(dataset[,6], predictors)
colnames(dataModel)[1] <- "Domestication"
```

### Formulas

The input formulas are defined, which are going to be used as input for the phyloglmstep function.

```{r declare formulas}
# Lowest VIF values - with all traits
formula1 <- Domestication ~ X1.1_ActivityCycle + X5.1_AdultBodyMass_g + X12.1_HabitatBreadth + X21.1_PopulationDensity_n_km2 + X10.2_SocialGrpSize + MatingSystem + YearRoundBreeding + Horns_Antlers + AVGMovingSpeed + AVGTravelDistance + Aspect + ClayPercentage + OrganicCarbon



```


### Model selection

With the use of the phyloglmstep() function, written by Rutger Vos.


# WIP 
Error in phyloglm(formula, data, phy, method, btol, log.alpha.bound, start.beta, : the number of rows in the data does not match the number of tips in the tree.

```{r model selection}
# Both give 219 - so i dont know where it goes wrong
NROW(dataset)
Ntip(tree)

phyloglmstep(formula1, starting.formula = NULL, data=dataset, phy=tree, 
             method="logistic_MPLE", direction = "forward", trace = 2, 
             btol = 10, log.alpha.bound = 4, start.beta=NULL, 
             start.alpha=NULL, boot = 0, full.matrix = TRUE, k=2)
```


Look at if the species have data in every trait from the formula

complete.cases (zoiets)



